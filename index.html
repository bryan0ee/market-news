<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Market‑Moving News</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Bilingual (EN/KR) market-moving news summaries with impact calls and affected tickers." />
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-5xl mx-auto px-4 py-4 flex items-center justify-between">
      <h1 class="text-xl md:text-2xl font-bold">Market‑Moving News Dashboard</h1>
      <div class="flex gap-2 items-center">
        <label class="text-sm">Language</label>
        <select id="lang" class="border rounded-lg px-2 py-1 text-sm">
          <option value="bilingual">Bilingual</option>
          <option value="en">English</option>
          <option value="ko">한국어</option>
        </select>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-4 py-6">
    <section class="mb-4 grid gap-3 md:grid-cols-4">
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1">Search headlines</label>
        <input id="q" placeholder="Search… (e.g., CPI, tariffs, NVDA)" class="w-full border rounded-xl px-3 py-2" />
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Impact</label>
        <select id="impact" class="w-full border rounded-xl px-3 py-2">
          <option value="">All</option>
          <option value="Bullish">Bullish</option>
          <option value="Bearish">Bearish</option>
          <option value="Neutral">Neutral</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Min confidence</label>
        <input id="conf" type="number" min="1" max="5" step="1" value="1" class="w-full border rounded-xl px-3 py-2" />
      </div>
    </section>

    <section class="mb-2">
      <div class="flex flex-wrap gap-2 text-sm" id="tickerChips"></div>
    </section>

    <section class="mb-4 flex items-center justify-between text-sm text-slate-600">
      <div>Last updated: <span id="lastUpdated">—</span></div>
      <button id="refresh" class="px-3 py-1.5 rounded-lg border bg-white hover:bg-slate-50">Refresh</button>
    </section>

    <section id="list" class="grid gap-3"></section>

    <footer class="mt-10 py-8 text-center text-xs text-slate-500">
      Built for fast daily review • Bilingual summaries • Filter by impact/tickers • Single‑file static site
    </footer>
  </main>

  <script>
    // --- Configuration ---
    const WATCHLIST = [
      'NVDA','GOOGL','MSFT','ORCL','CSCO','AMD','SNOW','META','CRWD',
      'DUK','WM','NEE','ED','RSG','COST','PG'
    ];

    // Try to fetch data.json from the same folder. If missing, fall back to inline sample
    async function loadData() {
      try {
        const res = await fetch('data.json?_=' + Date.now());
        if (!res.ok) throw new Error('data.json not found');
        return await res.json();
      } catch (e) {
        console.warn('Using inline sample because data.json is missing:', e.message);
        return {
          last_updated: new Date().toISOString(),
          items: [
            {
              ts: new Date().toISOString(),
              headline: 'Sample: Fed official signals patience on rate cuts',
              url: '#',
              impact: 'Neutral',
              confidence: 3,
              affected: ['SPX','NDX','NVDA','MSFT','COST'],
              summary_en: 'A senior Fed official emphasized data‑dependence; markets price steady path.',
              summary_ko: '연준 고위 인사가 데이터 중심 접근을 강조. 시장은 현상 유지 경로를 반영.',
              next_en: 'Watch CPI (21:30 KST) and FOMC minutes tomorrow.',
              next_ko: '금일 21:30 KST CPI, 내일 FOMC 의사록 주목.'
            },
            {
              ts: new Date().toISOString(),
              headline: 'Sample: Large cap AI guides higher, hyperscaler capex intact',
              url: '#',
              impact: 'Bullish',
              confidence: 4,
              affected: ['NVDA','GOOGL','MSFT','AMD','SNOW','META','CRWD'],
              summary_en: 'AI suppliers cite strong backlog; cloud capex unchanged QoQ.',
              summary_ko: 'AI 공급사 주문잔고 견조, 클라우드 설비투자 전분기 대비 유지.',
              next_en: 'Next: NVDA developer conference keynote (time TBA).',
              next_ko: '다음: NVDA 개발자 행사 기조연설(시간 추후).'
            }
          ]
        };
      }
    }

    const state = {
      data: { last_updated: null, items: [] },
      query: '',
      impact: '',
      minConf: 1,
      tickers: new Set(),
      lang: 'bilingual'
    };

    function chipHTML(t, selected) {
      return `<button data-ticker="${t}" class="px-2.5 py-1 rounded-full border ${selected? 'bg-slate-900 text-white' : 'bg-white hover:bg-slate-50'}">${t}</button>`;
    }

    function impactBadge(impact) {
      const map = { Bullish: 'bg-green-100 text-green-800 border-green-200', Bearish: 'bg-red-100 text-red-800 border-red-200', Neutral: 'bg-amber-100 text-amber-800 border-amber-200' };
      return `<span class="text-xs px-2 py-0.5 rounded-full border ${map[impact]||'bg-slate-100 text-slate-700 border-slate-200'}">${impact}</span>`;
    }

    function render() {
      // Render chips
      const chipContainer = document.getElementById('tickerChips');
      chipContainer.innerHTML = WATCHLIST.map(t => chipHTML(t, state.tickers.has(t))).join('');

      // Filter items
      const q = state.query.toLowerCase();
      const items = state.data.items.filter(x => {
        const matchesQ = !q || x.headline.toLowerCase().includes(q) || (x.summary_en+ x.summary_ko).toLowerCase().includes(q);
        const matchesImpact = !state.impact || x.impact === state.impact;
        const matchesConf = (x.confidence||1) >= state.minConf;
        const matchesTicker = state.tickers.size === 0 || x.affected?.some(t => state.tickers.has(t));
        return matchesQ && matchesImpact && matchesConf && matchesTicker;
      });

      // Render list
      const list = document.getElementById('list');
      if (!items.length) {
        list.innerHTML = `<div class="p-6 bg-white rounded-2xl border text-slate-600">No items match your filters.</div>`;
      } else {
        list.innerHTML = items.map(x => `
          <article class="p-4 md:p-5 bg-white rounded-2xl border">
            <div class="flex flex-wrap items-center gap-2 justify-between">
              <a href="${x.url}" target="_blank" class="font-semibold hover:underline">${x.headline}</a>
              <div class="flex items-center gap-2">${impactBadge(x.impact)}<span class="text-xs text-slate-500">Conf: ${x.confidence||1}/5</span></div>
            </div>
            <div class="mt-1 text-xs text-slate-500">${new Date(x.ts).toLocaleString()}</div>

            <div class="mt-3 space-y-2 text-sm">
              ${state.lang !== 'ko' ? `<p>${x.summary_en||''}</p>`:''}
              ${state.lang !== 'en' ? `<p class="text-slate-700">${x.summary_ko||''}</p>`:''}
            </div>

            <div class="mt-3 flex flex-wrap items-center gap-2 text-xs">
              <span class="text-slate-500">Affected:</span>
              ${(x.affected||[]).map(t=>`<span class="px-2 py-0.5 border rounded-full bg-slate-50">${t}</span>`).join('')}
            </div>

            <div class="mt-3 grid md:grid-cols-2 gap-2 text-xs">
              ${state.lang !== 'ko' ? `<div class="p-3 bg-slate-50 rounded-xl"><span class="font-medium">Next:</span> ${x.next_en||''}</div>`:''}
              ${state.lang !== 'en' ? `<div class="p-3 bg-slate-50 rounded-xl"><span class="font-medium">다음:</span> ${x.next_ko||''}</div>`:''}
            </div>
          </article>
        `).join('');
      }

      document.getElementById('lastUpdated').textContent = state.data.last_updated ? new Date(state.data.last_updated).toLocaleString() : '—';
    }

    // Event wiring
    document.getElementById('q').addEventListener('input', (e)=>{ state.query = e.target.value; render(); });
    document.getElementById('impact').addEventListener('change', (e)=>{ state.impact = e.target.value; render(); });
    document.getElementById('conf').addEventListener('input', (e)=>{ state.minConf = Number(e.target.value)||1; render(); });
    document.getElementById('lang').addEventListener('change', (e)=>{ state.lang = e.target.value; render(); });

    document.getElementById('tickerChips').addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-ticker]');
      if (!btn) return;
      const t = btn.dataset.ticker;
      if (state.tickers.has(t)) state.tickers.delete(t); else state.tickers.add(t);
      render();
    });

    document.getElementById('refresh').addEventListener('click', async ()=>{ state.data = await loadData(); render(); });

    // Init
    (async () => {
      state.data = await loadData();
      render();
    })();
  </script>
</body>
</html>
